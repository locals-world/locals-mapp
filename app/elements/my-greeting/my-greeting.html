<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/geo-location/geo-location.html">

<dom-module id="my-greeting">
  <template>

    <style>
    :host {
      display: block;
    }

    span {
      @apply(--paper-font-body1);
    }

    #googlemap {
      width: 100vw;
      height: 90vh;
    }
    </style>

    <geo-location watchpos highAccuracy id="geolocation" longitude="{{longitude}}" latitude="{{latitude}}"></geo-location>
    <google-map api-key="AIzaSyC-ywBkfduvR3yeC6sf8ePFre1-cSuL8oY" map="{{map}}" zoom="{{zoom}}" latitude="{{latitude}}" longitude="{{longitude}}" id="googlemap">
      <template is="dom-repeat" items="{{ data }}">
        <google-map-marker latitude="{{item.latitude}}" longitude="{{item.longitude}}"></google-map-marker>
      </template>
    </google-map>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'my-greeting',

        properties: {
          greeting: {
            type: String,
            value: 'Welcome!',
            notify: true
          },

          data: {
            type: Array,
            value: [{'latitude': 51.230101399999995, 'longitude': 4.386792},
                    {'latitude': 51.231101399999995, 'longitude': 4.386792},
                    {'latitude': 51.232101399999995, 'longitude': 4.386792},
                    {'latitude': 51.233101399999995, 'longitude': 4.386792}]
          },

          zoom: {
            type: Number,
            value: 15
          }
        },

        ready: function(){
          var self = this;

          this.$.geolocation.addEventListener('geo-response', function(e) {
            self.latitude = e.detail.latitude;
            self.longitude = e.detail.longitude;
            self.$.googlemap.resize();

            console.log('got geo: ', self.latitude, ' - ', self.longitude);
            //afstand = self.CalculateDistance(latitude, longitude, oldLatitude, oldLongitude);
            //   if(afstand>0.001){
            //     if(!locationPaused){
            //       this.fire('poschanged');
            //       oldLatitude = latitude;
            //       oldLongitude = longitude;
            //     }
            //   }
            });
        }
      });
    })();
  </script>
</dom-module>
