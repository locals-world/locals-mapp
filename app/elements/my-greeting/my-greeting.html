<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/geo-location/geo-location.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<dom-module id="my-greeting">
  <template>

    <style>
    :host {
      display: block;
    }

    span {
      @apply(--paper-font-body1);
    }

    #googlemap {
      width: 100vw;
      height: 90vh;
    }

    paper-fab {
      width: 60px;
      height: 60px;
      position: absolute;
      bottom: 40px;
      right: 40px;
      z-index: 99;
    }
    </style>
    <paper-fab icon="add" on-tap="goAddOffer"></paper-fab>
    <paper-fab-menu icon="menu" closeIcon="close" duration="0.3">
  <paper-fab-menu-item icon="info-outline" color="blue;" tooltip="Information"></paper-fab-menu-item>
  <paper-fab-menu-item icon="alarm" color="purple;" tooltip="Alarm"></paper-fab-menu-item>
  <paper-fab-menu-item icon="star-outline" color="green;" tooltip="Favorites"></paper-fab-menu-item>
  <paper-fab-menu-item icon="list" color="orange;" tooltip="List"></paper-fab-menu-item>
</paper-fab-menu>
    <geo-location watchpos highAccuracy id="geolocation" longitude="{{longitude}}" latitude="{{latitude}}"></geo-location>
    <google-map api-key="AIzaSyC-ywBkfduvR3yeC6sf8ePFre1-cSuL8oY" map="{{map}}" zoom="{{zoom}}" latitude="{{latitude}}" longitude="{{longitude}}" id="googlemap" disable-default-ui>
      <template is="dom-repeat" items="{{ data }}">
        <google-map-marker offerid="{{item.info}}" click-events on-google-map-marker-click="selectoffer" latitude="{{item.latitude}}" longitude="{{item.longitude}}"></google-map-marker>
      </template>
    </google-map>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'my-greeting',

        properties: {
          greeting: {
            type: String,
            value: 'Welcome!',
            notify: true
          },

          data: {
            type: Array,
            value: [{'latitude': 51.230101399999995, 'longitude': 4.386792, 'info': 'testing1'},
                    {'latitude': 51.231101399999995, 'longitude': 4.386792, 'info': 'testing2'},
                    {'latitude': 51.232101399999995, 'longitude': 4.386792, 'info': 'testing3'},
                    {'latitude': 51.233101399999995, 'longitude': 4.386792, 'info': 'testing4'}]
          },

          zoom: {
            type: Number,
            value: 15
          }
        },

        ready: function() {
          var self = this;

          this.$.geolocation.addEventListener('geo-response', function(e) {
            self.latitude = e.detail.latitude;
            self.longitude = e.detail.longitude;
            self.$.googlemap.resize();
            console.log('got geo: ', self.latitude, ' - ', self.longitude);
          });
        },

        selectoffer: function(e) {
          //console.log('arker',e.target.offerid);
          page('/users/' + e.target.offerid);
        },

        goAddOffer: function() {
          page('/newoffer');
        }
      });
    })();
  </script>
</dom-module>
