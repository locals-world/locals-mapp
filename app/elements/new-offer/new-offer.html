<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="new-offer">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-material {
        padding: 12px;
        margin: 24px;
      }
    </style>
    <paper-material elevation="1">
      <h1>Create a new offer</h1>
      <paper-input label="Hashtag" placeholder="Rideshare" value="Rideshare"></paper-input>
      <paper-input label="Description" placeholder="Pick me up" value="Pick me up"></paper-input>
      <paper-input label="Starts" value="datepicker"></paper-input>
      <paper-input label="Duration" value="30"></paper-input>
      <paper-input label="Where" placeholder="Here" value="geohash"></paper-input>
      <paper-button raised on-tap="newOffer">Publish offer</paper-button>
    </paper-material>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'new-offer',

      properties: {
        foo: {
          type: String,
          value: 'new-offer',
          notify: true
        },
        web3: {
          type: Object,
        },
        account: {
          type: String
        }
      },

      attached: function() {
        //this.web3 = document.querySelector('web3-wallet');
      },
      newOffer: function() {
        console.log('new offer', this.web3);
        var self = this;
        app.helpers.getfile('../../contracts/localsInOut.json', function(err, contractjson) {
          console.log(err, contractjson);
          self.web3.eth.getGasPrice(function(err, result) {
            var gasPrice = result.toNumber(10);
            var MyContract = self.web3.eth.contract(contractjson.abi);
            var myContractInstance = MyContract.at(contractjson.address);
            var account = app.helpers.fixaddress(self.account);
            result = myContractInstance.newOffer.sendTransaction('0x0',10,'ipfshash',1,2, {
                from: account,
                gasPrice: gasPrice,
                gasLimit: 600000,
                gas: 600000,
                data: contractjson.bytecode
              },
              function(err, result) {
                if (err !== null) {
                  console.log(err);
                  console.log('ERROR: Transaction didnt go through. See console.');
                } else {
                  console.log('Transaction Successful!');
                  //self.progress = 'addedtoindex';
                  console.log('Tx hash=', result);
                  // set vote status to TxHash received
                  //self.votestatus = 2;
                  //self.transactionHash = result;
                }
                //fn(err, result);
              });
          });
        });

      }
    });
  })();
  </script>
</dom-module>
